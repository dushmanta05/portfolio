---
import MainHead from '@components/MainHead.astro';
import Nav from '@components/Nav.astro';
import Footer from '@components/Footer.astro';

interface Props {
  title?: string | undefined;
  description?: string | undefined;
  seoTitle?: string | undefined;
  seoDescription?: string | undefined;
  image?: string | undefined;
  ogImage?: string | undefined;
  publishDate?: string | undefined;
  articleType?: 'website' | 'article';
}

const {
  seoTitle,
  seoDescription,
  title: rawTitle = 'Dushmanta | Portfolio',
  description: rawDescription,
  image = 'https://dushmanta.dev/og-image.png',
  ogImage,
  publishDate,
  articleType = 'website',
} = Astro.props;

const homepageDescription =
  'Full-Stack Developer specializing in backend development. Building efficient digital solutions with Node.js, MongoDB, and modern web technologies.';

const isHomePage = Astro.url.pathname === '/';

const title = seoTitle || rawTitle;
const description = isHomePage ? homepageDescription : seoDescription || rawDescription;

const finalImage = ogImage || image;
const canonicalURL = new URL(Astro.url.pathname, 'https://dushmanta.dev');
---

<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <meta name='viewport' content='width=device-width' />

    <!-- Canonical URL -->
    <link rel='canonical' href={canonicalURL} />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name='title' content={title} />
    <meta name='description' content={description} />

    <!-- Open Graph / Meta -->
    <meta property='og:site_name' content='Dushmanta | Portfolio' />
    <meta property='og:type' content={articleType} />
    {
      articleType === 'article' && publishDate && (
        <meta property='article:published_time' content={publishDate} />
      )
    }
    <meta property='og:url' content={canonicalURL} />
    <meta property='og:title' content={title} />
    <meta property='og:description' content={description} />
    <meta property='og:image' content={finalImage} />
    <meta property='og:image:alt' content='Dushmanta Portfolio Preview' />

    <!-- Twitter -->
    <meta name='twitter:card' content='summary_large_image' />
    <meta name='twitter:creator' content='@dushmanta05' />
    <meta name='twitter:site' content='@dushmanta05' />
    <meta name='twitter:url' content={canonicalURL} />
    <meta name='twitter:title' content={title} />
    <meta name='twitter:description' content={description} />
    <meta name='twitter:image' content={finalImage} />
    <meta name='twitter:image:alt' content='Dushmanta Portfolio Preview' />

    <!-- LinkedIn -->
    <meta property='og:type' content='article' />
    <meta property='article:author' content='Dushmanta' />
    <meta property='article:published_time' content={new Date().toISOString()} />

    <!-- Discord -->
    <meta property='og:image:width' content='1200' />
    <meta property='og:image:height' content='630' />

    <meta name='author' content='Dushmanta' />
    <meta name='robots' content='index, follow' />
    <meta name='theme-color' content='#7f6df2' />

    <!-- Apple Touch Icon -->
    <link rel='apple-touch-icon' sizes='180x180' href='/apple-touch-icon.png' />
    <link rel='icon' type='image/png' sizes='32x32' href='/favicon-32x32.png' />
    <link rel='icon' type='image/png' sizes='16x16' href='/favicon-16x16.png' />

    <MainHead title={title} description={description} />
  </head>
  <body>
    <div class='stack backgrounds'>
      <Nav />
      <slot />
      <div class='wrapper gap-12 lg:gap-16'>
        <Footer />
      </div>
    </div>

    <script>
      addEventListener('load', () => document.documentElement.classList.add('loaded'));
    </script>

    <!-- JSON-LD Structured Data for better SEO -->
    <script is:inline type='application/ld+json'>
      {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Dushmanta",
        "url": "https://dushmanta.dev",
        "sameAs": [
          "https://twitter.com/dushmanta05",
          "https://linkedin.com/in/your-linkedin-handle",
          "https://github.com/your-github-handle"
        ],
        "jobTitle": "Full-Stack Developer",
        "description": "Full-Stack Developer specializing in backend development. Building efficient digital solutions with Node.js, MongoDB, and modern web technologies."
      }
    </script>

    <style>
      :root {
        --_placeholder-bg: linear-gradient(transparent, transparent);
        --bg-image-subtle-1: var(--_placeholder-bg);
        --bg-image-subtle-2: var(--_placeholder-bg);
        --bg-image-footer: var(--_placeholder-bg);
        --bg-svg-blend-mode: overlay;
        --bg-blend-mode: darken;
        --bg-image-aspect-ratio: 2.25;
        --bg-scale: 1.68;
        --bg-aspect-ratio: calc(var(--bg-image-aspect-ratio) / var(--bg-scale));
        --bg-gradient-size: calc(var(--bg-scale) * 100%);
      }

      :root.theme-dark {
        --bg-svg-blend-mode: darken;
        --bg-blend-mode: lighten;
      }

      .backgrounds {
        min-height: 100%;
        isolation: isolate;
        background:
					/*noise*/
          /*footer*/
          var(--bg-image-footer) bottom center/var(--bg-gradient-size) no-repeat,
          /*header1*/ var(--bg-image-main-curves) top center/var(--bg-gradient-size) no-repeat,
          /*header2*/ var(--bg-image-main) top center/var(--bg-gradient-size) no-repeat,
          /*base*/ var(--gray-999);
        background-blend-mode: /*noise*/
          overlay,
          /*footer*/ var(--bg-blend-mode),
          /*header1*/ var(--bg-svg-blend-mode),
          /*header2*/ normal,
          /*base*/ normal;
      }

      .wrapper {
        max-width: 80rem;
        margin: 0 auto;
        padding: 0 1rem;
      }
      @media (forced-colors: active) {
        /* Deactivate custom backgrounds for high contrast users. */
        .backgrounds {
          background: none;
          background-blend-mode: none;
          --bg-gradient-size: none;
        }
      }

      @media (min-width: 768px) {
        .wrapper {
          padding: 0 2rem;
        }
      }
    </style>
  </body>
</html>
